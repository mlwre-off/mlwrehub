-- GUI Module: улучшенный интерфейс аутентификации ключа
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Создание ScreenGui с улучшенным дизайном
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "QUESTXGUI"
screenGui.IgnoreGuiInset = true
screenGui.ResetOnSpawn = false
screenGui.DisplayOrder = 999999
screenGui.ScreenInsets = Enum.ScreenInsets.None
screenGui.Parent = game.CoreGui

-- Фон с градиентом
local frame = Instance.new("Frame")
frame.Name = "MainFrame"
frame.Size = UDim2.fromScale(2, 2)
frame.Position = UDim2.fromScale(-0.5, -0.5)
frame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
frame.BackgroundTransparency = 0.1
frame.BorderSizePixel = 0
frame.ZIndex = 1
frame.Parent = screenGui

-- Добавление градиента для фона
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 20, 30)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(30, 30, 45)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 30))
})
gradient.Rotation = 45
gradient.Parent = frame

-- Анимация градиента
local gradientTween = TweenService:Create(
    gradient, 
    TweenInfo.new(15, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, -1), 
    {Rotation = 225}
)
gradientTween:Play()

-- Центрированный контейнер для элементов GUI
local centerFrame = Instance.new("Frame")
centerFrame.Name = "CenterFrame"
centerFrame.Size = UDim2.new(0, 450, 0, 380)
centerFrame.Position = UDim2.new(0.5, -225, 0.5, -190)
centerFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
centerFrame.BackgroundTransparency = 0.2
centerFrame.ZIndex = 2
centerFrame.Parent = screenGui

-- Добавление углов для контейнера
local cornerRadius = Instance.new("UICorner")
cornerRadius.CornerRadius = UDim.new(0, 15)
cornerRadius.Parent = centerFrame

-- Добавление эффекта тени
local shadow = Instance.new("ImageLabel")
shadow.Name = "Shadow"
shadow.AnchorPoint = Vector2.new(0.5, 0.5)
shadow.BackgroundTransparency = 1
shadow.Position = UDim2.new(0.5, 0, 0.5, 0)
shadow.Size = UDim2.new(1, 35, 1, 35)
shadow.ZIndex = 1
shadow.Image = "rbxassetid://5554236805"
shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
shadow.ImageTransparency = 0.4
shadow.Parent = centerFrame

-- Функция для создания текстовой метки с анимацией
local function createTextLabel(parent, text, position, size, fontSize)
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = size or UDim2.new(0, 200, 0, 30)
    textLabel.Position = position
    textLabel.Text = text
    textLabel.Font = Enum.Font.GothamSemibold
    textLabel.TextSize = fontSize or 20
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.BackgroundTransparency = 1
    textLabel.TextXAlignment = Enum.TextXAlignment.Left
    textLabel.ZIndex = 3
    textLabel.Parent = parent
    
    -- Добавление анимации появления
    textLabel.TextTransparency = 1
    local tweenAppear = TweenService:Create(
        textLabel,
        TweenInfo.new(0.6, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
        {TextTransparency = 0}
    )
    tweenAppear:Play()
    
    return textLabel
end

-- Функция для создания улучшенного радиального загрузчика
local function createRadialLoader(parent, targetTextLabel, offsetX, offsetY)
    local loaderFrame = Instance.new("Frame")
    loaderFrame.Size = UDim2.new(0, 24, 0, 24)
    loaderFrame.BackgroundTransparency = 1
    loaderFrame.ZIndex = 4
    loaderFrame.Parent = parent

    -- Фон загрузчика
    local loaderBg = Instance.new("Frame")
    loaderBg.Size = UDim2.new(1, 0, 1, 0)
    loaderBg.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    loaderBg.ZIndex = 3
    loaderBg.Parent = loaderFrame
    
    local cornerLoader = Instance.new("UICorner")
    cornerLoader.CornerRadius = UDim.new(1, 0)
    cornerLoader.Parent = loaderBg

    -- Анимированная часть загрузчика
    local loader = Instance.new("ImageLabel")
    loader.Image = "rbxassetid://3926305904"
    loader.ImageRectOffset = Vector2.new(124, 124)
    loader.ImageRectSize = Vector2.new(36, 36)
    loader.Size = UDim2.new(0.8, 0, 0.8, 0)
    loader.Position = UDim2.new(0.1, 0, 0.1, 0)
    loader.BackgroundTransparency = 1
    loader.ImageColor3 = Color3.fromRGB(80, 170, 255)
    loader.ZIndex = 4
    loader.Parent = loaderFrame

    loaderFrame.Position = UDim2.new(
        targetTextLabel.Position.X.Scale,
        targetTextLabel.Position.X.Offset + offsetX,
        targetTextLabel.Position.Y.Scale,
        targetTextLabel.Position.Y.Offset + offsetY
    )

    -- Запуск анимации вращения с плавным появлением
    loader.ImageTransparency = 1
    local tweenAppear = TweenService:Create(
        loader,
        TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
        {ImageTransparency = 0}
    )
    tweenAppear:Play()
    
    -- Анимация вращения
    local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, -1)
    local tween = TweenService:Create(loader, tweenInfo, {Rotation = 360})
    tween:Play()

    return loaderFrame
end

-- Функция для создания улучшенной галочки с анимацией
local function createGalka(parent, targetTextLabel, offsetX, offsetY)
    local galkaFrame = Instance.new("Frame")
    galkaFrame.Size = UDim2.new(0, 24, 0, 24)
    galkaFrame.BackgroundTransparency = 1
    galkaFrame.ZIndex = 4
    galkaFrame.Parent = parent

    -- Фон галочки
    local galkaBg = Instance.new("Frame")
    galkaBg.Size = UDim2.new(1, 0, 1, 0)
    galkaBg.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    galkaBg.ZIndex = 3
    galkaBg.Parent = galkaFrame
    
    local cornerGalka = Instance.new("UICorner")
    cornerGalka.CornerRadius = UDim.new(1, 0)
    cornerGalka.Parent = galkaBg

    local galka = Instance.new("ImageLabel")
    galka.Image = "rbxassetid://3926305904"
    galka.ImageRectOffset = Vector2.new(312, 4)
    galka.ImageRectSize = Vector2.new(24, 24)
    galka.Size = UDim2.new(0.7, 0, 0.7, 0)
    galka.Position = UDim2.new(0.15, 0, 0.15, 0)
    galka.BackgroundTransparency = 1
    galka.ImageColor3 = Color3.fromRGB(80, 220, 120)
    galka.ZIndex = 4
    galka.Parent = galkaFrame

    galkaFrame.Position = UDim2.new(
        targetTextLabel.Position.X.Scale,
        targetTextLabel.Position.X.Offset + offsetX,
        targetTextLabel.Position.Y.Scale,
        targetTextLabel.Position.Y.Offset + offsetY
    )
    
    -- Анимация появления
    galka.ImageTransparency = 1
    galkaBg.BackgroundTransparency = 1
    
    local tweenBg = TweenService:Create(
        galkaBg,
        TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
        {BackgroundTransparency = 0}
    )
    
    local tweenGalka = TweenService:Create(
        galka,
        TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
        {ImageTransparency = 0, Size = UDim2.new(0.7, 0, 0.7, 0)}
    )
    
    tweenBg:Play()
    task.wait(0.2)
    tweenGalka:Play()

    return galkaFrame
end

-- Создание информационных текстовых меток с анимацией
local infoContainer = Instance.new("Frame")
infoContainer.Name = "InfoContainer"
infoContainer.Size = UDim2.new(0, 300, 0, 130)
infoContainer.Position = UDim2.new(0.5, -150, 0.85, -10)
infoContainer.BackgroundTransparency = 1
infoContainer.ZIndex = 3
infoContainer.Parent = centerFrame

-- Улучшенные информационные метки
local text1 = createTextLabel(infoContainer, "Data fetching", UDim2.new(0, 60, 0, 0), UDim2.new(0, 240, 0, 30), 18)
local loader1 = createRadialLoader(infoContainer, text1, -35, 3)
task.wait(0.6)
text1.Text = "Data fetched!"
local galka1 = createGalka(infoContainer, text1, -35, 3)
loader1.Visible = false

task.wait(0.3)
local text2 = createTextLabel(infoContainer, "Loading Key System", UDim2.new(0, 60, 0, 40), UDim2.new(0, 240, 0, 30), 18)
local loader2 = createRadialLoader(infoContainer, text2, -35, 3)
task.wait(0.8)
text2.Text = "Loaded Key System!"
local galka2 = createGalka(infoContainer, text2, -35, 3)
loader2.Visible = false

task.wait(0.3)
local text3 = createTextLabel(infoContainer, "Waiting for you to enter key...", UDim2.new(0, 60, 0, 80), UDim2.new(0, 240, 0, 30), 18)
local loader3 = createRadialLoader(infoContainer, text3, -35, 3)

-- Создание заголовка интерфейса с анимацией
local titleLabel = Instance.new("TextLabel")
titleLabel.Text = "Quest X Authentication"
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 36
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.BackgroundTransparency = 1
titleLabel.Size = UDim2.new(1, 0, 0, 50)
titleLabel.Position = UDim2.new(0, 0, 0, 20)
titleLabel.TextTransparency = 1
titleLabel.ZIndex = 3
titleLabel.Parent = centerFrame

-- Подсветка заголовка
local titleGlow = Instance.new("ImageLabel")
titleGlow.Size = UDim2.new(1.2, 0, 1.5, 0)
titleGlow.Position = UDim2.new(-0.1, 0, -0.25, 0)
titleGlow.BackgroundTransparency = 1
titleGlow.Image = "rbxassetid://5554236805"
titleGlow.ImageColor3 = Color3.fromRGB(80, 120, 255)
titleGlow.ImageTransparency = 0.9
titleGlow.ZIndex = 2
titleGlow.Parent = titleLabel

-- Анимация заголовка
local titleTween = TweenService:Create(
    titleLabel, 
    TweenInfo.new(0.8, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), 
    {TextTransparency = 0}
)
titleTween:Play()

-- Пульсация подсветки заголовка
local function pulseGlow()
    while true do
        local tweenDown = TweenService:Create(
            titleGlow, 
            TweenInfo.new(2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), 
            {ImageTransparency = 0.95}
        )
        tweenDown:Play()
        task.wait(2)
        
        local tweenUp = TweenService:Create(
            titleGlow, 
            TweenInfo.new(2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), 
            {ImageTransparency = 0.85}
        )
        tweenUp:Play()
        task.wait(2)
    end
end
task.spawn(pulseGlow)

-- Подзаголовок с анимацией
local subtitleLabel = Instance.new("TextLabel")
subtitleLabel.Text = "Enter your key below to gain access:"
subtitleLabel.Font = Enum.Font.GothamMedium
subtitleLabel.TextSize = 20
subtitleLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
subtitleLabel.BackgroundTransparency = 1
subtitleLabel.Size = UDim2.new(1, 0, 0, 30)
subtitleLabel.Position = UDim2.new(0, 0, 0, 75)
subtitleLabel.TextTransparency = 1
subtitleLabel.ZIndex = 3
subtitleLabel.Parent = centerFrame

-- Анимация подзаголовка
local subtitleTween = TweenService:Create(
    subtitleLabel, 
    TweenInfo.new(0.8, Enum.EasingStyle.Quart, Enum.EasingDirection.Out, 0, false, 0.1), 
    {TextTransparency = 0}
)
subtitleTween:Play()

-- Улучшенное поле ввода ключа
local keyInput = Instance.new("TextBox")
keyInput.PlaceholderText = "Enter your key here"
keyInput.Font = Enum.Font.GothamMedium
keyInput.TextSize = 18
keyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
keyInput.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
keyInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 170)
keyInput.BackgroundTransparency = 0.3
keyInput.Size = UDim2.new(0.8, 0, 0, 50)
keyInput.Position = UDim2.new(0.1, 0, 0, 125)
keyInput.BorderSizePixel = 0
keyInput.Text = ""
keyInput.ClearTextOnFocus = false
keyInput.TextTransparency = 1
keyInput.BackgroundTransparency = 1
keyInput.ZIndex = 3
keyInput.Parent = centerFrame

-- Эффект рамки для TextBox
local keyInputBorder = Instance.new("UIStroke")
keyInputBorder.Color = Color3.fromRGB(80, 120, 255)
keyInputBorder.Thickness = 2
keyInputBorder.Transparency = 1
keyInputBorder.Parent = keyInput

-- Скругление углов поля ввода
local inputCorner = Instance.new("UICorner")
inputCorner.CornerRadius = UDim.new(0, 10)
inputCorner.Parent = keyInput

-- Анимация появления поля ввода
local keyInputTween = TweenService:Create(
    keyInput, 
    TweenInfo.new(0.8, Enum.EasingStyle.Quart, Enum.EasingDirection.Out, 0, false, 0.2), 
    {TextTransparency = 0, BackgroundTransparency = 0.3}
)
keyInputTween:Play()

-- Анимация рамки поля ввода
local keyInputBorderTween = TweenService:Create(
    keyInputBorder, 
    TweenInfo.new(0.8, Enum.EasingStyle.Quart, Enum.EasingDirection.Out, 0, false, 0.2), 
    {Transparency = 0}
)
keyInputBorderTween:Play()

-- Улучшенная кнопка проверки ключа
local verifyButton = Instance.new("TextButton")
verifyButton.Text = "Verify Key"
verifyButton.Font = Enum.Font.GothamBold
verifyButton.TextSize = 20
verifyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
verifyButton.BackgroundColor3 = Color3.fromRGB(80, 120, 255)
verifyButton.BackgroundTransparency = 1
verifyButton.Size = UDim2.new(0.8, 0, 0, 50)
verifyButton.Position = UDim2.new(0.1, 0, 0, 195)
verifyButton.BorderSizePixel = 0
verifyButton.TextTransparency = 1
verifyButton.ZIndex = 3
verifyButton.Parent = centerFrame

-- Скругление углов кнопки
local verifyCorner = Instance.new("UICorner")
verifyCorner.CornerRadius = UDim.new(0, 10)
verifyCorner.Parent = verifyButton

-- Анимация появления кнопки проверки
local verifyTween = TweenService:Create(
    verifyButton, 
    TweenInfo.new(0.8, Enum.EasingStyle.Quart, Enum.EasingDirection.Out, 0, false, 0.3), 
    {TextTransparency = 0, BackgroundTransparency = 0}
)
verifyTween:Play()

-- Кнопка "Get Key" с улучшенным дизайном
local getKeyButton = Instance.new("TextButton")
getKeyButton.Text = "Get Key"
getKeyButton.Font = Enum.Font.GothamBold
getKeyButton.TextSize = 20
getKeyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
getKeyButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
getKeyButton.BackgroundTransparency = 1
getKeyButton.Size = UDim2.new(0.8, 0, 0, 50)
getKeyButton.Position = UDim2.new(0.1, 0, 0, 265)
getKeyButton.BorderSizePixel = 0
getKeyButton.TextTransparency = 1
getKeyButton.ZIndex = 3
getKeyButton.Parent = centerFrame

-- Скругление углов кнопки
local getKeyCorner = Instance.new("UICorner")
getKeyCorner.CornerRadius = UDim.new(0, 10)
getKeyCorner.Parent = getKeyButton

-- Анимация появления кнопки Get Key
local getKeyTween = TweenService:Create(
    getKeyButton, 
    TweenInfo.new(0.8, Enum.EasingStyle.Quart, Enum.EasingDirection.Out, 0, false, 0.4), 
    {TextTransparency = 0, BackgroundTransparency = 0}
)
getKeyTween:Play()

-- Метка статуса с улучшенным дизайном
local statusLabel = Instance.new("TextLabel")
statusLabel.Text = ""
statusLabel.Font = Enum.Font.GothamMedium
statusLabel.TextSize = 16
statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
statusLabel.BackgroundTransparency = 1
statusLabel.Size = UDim2.new(0.8, 0, 0, 30)
statusLabel.Position = UDim2.new(0.1, 0, 0, 330)
statusLabel.TextTransparency = 1
statusLabel.ZIndex = 3
statusLabel.Parent = centerFrame

-- Кнопка закрытия с улучшенным дизайном
local closeButton = Instance.new("ImageButton")
closeButton.Name = "Close"
closeButton.Size = UDim2.new(0, 35, 0, 35)
closeButton.Position = UDim2.new(1, -45, 0, 10)
closeButton.BackgroundTransparency = 1
closeButton.Image = "rbxassetid://3926305904"
closeButton.ImageRectOffset = Vector2.new(284, 4)
closeButton.ImageRectSize = Vector2.new(24, 24)
closeButton.ImageColor3 = Color3.fromRGB(200, 200, 200)
closeButton.ImageTransparency = 1
closeButton.ZIndex = 4
closeButton.Parent = centerFrame

-- Анимация появления кнопки закрытия
local closeTween = TweenService:Create(
    closeButton, 
    TweenInfo.new(0.8, Enum.EasingStyle.Quart, Enum.EasingDirection.Out, 0, false, 0.5), 
    {ImageTransparency = 0}
)
closeTween:Play()

-- Плавающая иконка с улучшенным дизайном
local floatingIcon = Instance.new("ImageButton", screenGui)
floatingIcon.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
floatingIcon.Image = "rbxassetid://117511501336791"
floatingIcon.Size = UDim2.new(0.07, 0, 0.132, 0)
floatingIcon.Name = "FloatingIcon"
floatingIcon.Visible = false
floatingIcon.Position = UDim2.new(0.09, 0, 0.016, 0)
floatingIcon.Draggable = true
floatingIcon.ZIndex = 5
floatingIcon.ImageTransparency = 1
floatingIcon.BackgroundTransparency = 1

local floatCorner = Instance.new("UICorner", floatingIcon)
floatCorner.CornerRadius = UDim.new(0.25, 0)

local floatStroke = Instance.new("UIStroke", floatingIcon)
floatStroke.Color = Color3.fromRGB(80, 120, 255)
floatStroke.Thickness = 2
floatStroke.Transparency = 1

local aspectRatioConstraint = Instance.new("UIAspectRatioConstraint", floatingIcon)
aspectRatioConstraint.AspectRatio = 1

-- Эффекты наведения для кнопок
local function setupButtonHoverEffect(button, originalColor, hoverColor)
    button.MouseEnter:Connect(function()
        local hoverTween = TweenService:Create(
            button,
            TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
            {BackgroundColor3 = hoverColor}
        )
        hoverTween:Play()
    end)
    
    button.MouseLeave:Connect(function()
        local leaveTween = TweenService:Create(
            button,
            TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
            {BackgroundColor3 = originalColor}
        )
        leaveTween:Play()
    end)
end

-- Настройка эффектов наведения
setupButtonHoverEffect(verifyButton, Color3.fromRGB(80, 120, 255), Color3.fromRGB(100, 140, 255))
setupButtonHoverEffect(getKeyButton, Color3.fromRGB(60, 60, 80), Color3.fromRGB(80, 80, 100))

-- Эффект фокуса для поля ввода
keyInput.Focused:Connect(function()
    local focusTween = TweenService:Create(
        keyInputBorder,
        TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
        {Color = Color3.fromRGB(100, 180, 255), Thickness = 3}
    )
    focusTween:Play()
end)

keyInput.FocusLost:Connect(function()
    local unfocusTween = TweenService:Create(
        keyInputBorder,
        TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
        {Color = Color3.fromRGB(80, 120, 255), Thickness = 2}
    )
    unfocusTween:Play()
end)

-- Эффект нажатия для кнопок
local function setupButtonPressEffect(button)
    button.MouseButton1Down:Connect(function()
        local pressTween = TweenService:Create(
            button,
            TweenInfo.new(0.1, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
            {Size = UDim2.new(button.Size.X.Scale * 0.97, button.Size.X.Offset, button.Size.Y.Scale * 0.97, button.Size.Y.Offset)}
        )
        pressTween:Play()
    end)
    
    button.MouseButton1Up:Connect(function()
        local releaseTween = TweenService:Create(
            button,
            TweenInfo.new(0.1, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
            {Size = UDim2.new(button.Size.X.Scale / 0.97, button.Size.X.Offset, button.Size.Y.Scale / 0.97, button.Size.Y.Offset)}
        )
        releaseTween:Play()
    end)
end

setupButtonPressEffect(verifyButton)
setupButtonPressEffect(getKeyButton)

-- Обновление размеров фона по размеру камеры (GUI адаптивность)
RunService.RenderStepped:Connect(function()
    local viewportSize = workspace.CurrentCamera.ViewportSize
    frame.Size = UDim2.new(0, viewportSize.X * 2, 0, viewportSize.Y * 2)
    frame.Position = UDim2.new(0.5, -viewportSize.X, 0.5, -viewportSize.Y)
end)

-- Возвращаем созданный GUI
return screenGui
